<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Executor Control Panel</title>
<link rel="stylesheet" href="style.css">
<style>
body { background:#0f0f0f; color:white; font-family:Arial; }
#loginBox { max-width:300px; margin:150px auto; text-align:center; padding:20px; background:#222; border-radius:10px; }
input { width:90%; padding:10px; margin:8px 0; border-radius:6px; border:none; }
button { padding:10px 15px; border:none; border-radius:6px; background:#0a84ff; color:white; cursor:pointer; margin-top:5px; }
#players { margin-top:20px; }
.playerBox { background:#181818; padding:10px; border-radius:8px; margin-bottom:10px; }
#cmdBox { margin-top:20px; background:#222; padding:15px; border-radius:8px; display:none; }
</style>
</head>
<body>

<div id="loginBox">
<h2>Executor Panel Login</h2>
<input type="text" id="username" placeholder="Username"><br>
<input type="password" id="password" placeholder="Password"><br>
<button onclick="login()">Login</button>
</div>

<div id="dashboard" style="display:none; padding:20px;">
<h2>ðŸ§ª Executor Control Panel</h2>
<h3 id="userCount">Players Online: 0</h3>
<div id="players"></div>

<div id="cmdBox">
<h3 id="selectedName"></h3>
<button onclick="sendCmd('kill')">Kill</button>
<button onclick="sendCmd('fling')">Fling</button>
<button onclick="sendCmd('sit')">Sit</button>
<button onclick="sendCmd('freeze')">Freeze</button>
<button onclick="sendCmd('unfreeze')">Unfreeze</button>
<button onclick="sendCmd('chat')">Send Chat Message</button>
</div>
</div>

<script>
const SERVER = window.location.origin; // Same Replit project
let currentSelected = null;

function login(){
    const user = document.getElementById("username").value;
    const pass = document.getElementById("password").value;
    if(user === "admin" && pass === "password"){
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("dashboard").style.display = "block";
        loadPlayers();
    } else alert("Invalid login");
}

async function loadPlayers(){
    const res = await fetch(SERVER + "/players");
    const players = await res.json();
    document.getElementById("userCount").innerText =
        "Players Online: " + Object.keys(players).length;

    const box = document.getElementById("players");
    box.innerHTML = "";

    for(let id in players){
        let p = players[id];
        let div = document.createElement("div");
        div.className = "playerBox";

        div.innerHTML = `
          <b>${p.username}</b><br>
          Chats: ${p.chats}<br>
          <button onclick="selectPlayer('${id}', '${p.username}')">
            ${p.selected ? "Unselect" : "Select"}
          </button>
        `;
        box.appendChild(div);
    }
}

async function selectPlayer(id,name){
    const newState = currentSelected !== id;
    await fetch(SERVER + "/select",{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({userid:id, selected:newState})
    });
    currentSelected = newState ? id : null;
    document.getElementById("cmdBox").style.display =
        newState ? "block" : "none";
    document.getElementById("selectedName").innerText =
        newState ? "Selected: " + name : "";
    loadPlayers();
}

async function sendCmd(cmd){
    if(!currentSelected) return;
    await fetch(SERVER + "/command",{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({userid: currentSelected, command: cmd})
    });
}

setInterval(loadPlayers, 800);
</script>
</body>
</html>
